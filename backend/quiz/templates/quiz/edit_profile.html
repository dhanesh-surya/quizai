{% extends 'quiz/base.html' %}

{% block title %}Edit Profile - MindSpark AI{% endblock %}

{% block content %}
<div class="card animate-fade-in" style="max-width: 500px; margin: 2rem auto;">
    <div class="page-header">
        <h1 class="page-title">Edit Profile</h1>
        <p class="page-subtitle">Update your personal information</p>
    </div>

    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}

        <div style="text-align: center; margin-bottom: 2rem;">
            <div class="profile-avatar-container">
                {% if user.profile.avatar %}
                <img src="{{ user.profile.avatar.url }}" alt="Profile" class="profile-avatar-img">
                {% else %}
                <div class="profile-avatar-placeholder">
                    <i class="fas fa-user"></i>
                </div>
                {% endif %}
            </div>
            <div class="form-group">
                <label for="avatar" class="btn btn-outline" style="cursor: pointer; font-weight: normal;">Change
                    Photo</label>
                <input type="file" id="avatar" name="avatar" style="display: none;" accept="image/*"
                    onchange="previewImage(this)">
                <div id="file-name" style="margin-top: 0.5rem; color: var(--text-muted); font-size: 0.85rem;"></div>
            </div>
        </div>

        <div class="form-group">
            <label for="name" class="form-label">Full Name</label>
            <input type="text" id="name" name="name" class="form-control" value="{{ user.first_name }}">
        </div>

        <div class="form-group">
            <label for="email" class="form-label">Email</label>
            <input type="email" id="email" name="email" class="form-control" value="{{ user.email }}" required>
        </div>

        <div style="margin: 2rem 0; border-top: 1px solid var(--border); padding-top: 1rem;">
            <p style="color: var(--text-muted); margin-bottom: 1rem; font-size: 0.9rem;">Leave blank to keep current
                password</p>

            <div class="form-group">
                <label for="password" class="form-label">New Password</label>
                <input type="password" id="password" name="password" class="form-control">
            </div>
        </div>

        <div style="display: flex; gap: 1rem;">
            <a href="{% url 'profile' %}" class="btn btn-outline" style="flex: 1; text-align: center;">Cancel</a>
            <button type="submit" class="btn btn-primary" style="flex: 1;">Save Changes</button>
        </div>
    </form>
</div>

<script>
    function previewImage(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();

            reader.onload = function (e) {
                // Check if image exists, if not replace placeholder
                var container = document.querySelector('.profile-avatar-container');
                var existingImg = container.querySelector('img');

                if (existingImg) {
                    existingImg.src = e.target.result;
                } else {
                    container.innerHTML = '<img src="' + e.target.result + '" alt="Profile" class="profile-avatar-img">';
                }
            }

            reader.readAsDataURL(input.files[0]);
            document.getElementById('file-name').textContent = input.files[0].name;
        }
    }
</script>
{% endblock %}